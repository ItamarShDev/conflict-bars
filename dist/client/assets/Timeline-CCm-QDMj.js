import{u as K,b as k,c as Y,r as h,j as e}from"./main-QXOoeVpc.js";function B({onSuccess:s,translations:t}){const i=K(k.mutations.submitSongWithUser),r=Y(k.songs.getAllSongs)??[],n=Y(k.artists.getAllArtists)??[],[o,c]=h.useState("idle"),[a,x]=h.useState(null),d=h.useId(),g=h.useId(),{artistOptions:y,languages:l}=h.useMemo(()=>{const m=new Set;for(const u of r)u.language&&m.add(u.language);return{artistOptions:n.map(u=>({id:u._id,name:u.name})).sort((u,j)=>u.name.localeCompare(j.name)),languages:Array.from(m).sort((u,j)=>u.localeCompare(j))}},[r,n]),f=h.useMemo(()=>{const m=new Map;for(const b of y)b.name&&m.set(b.name.toLowerCase(),b.id);return m},[y]),p=async m=>{m.preventDefault(),c("submitting"),x(null);const b=m.currentTarget,u=new FormData(b),j=u.get("displayName")?.trim(),S=(u.get("email")??"").trim(),_=u.get("songName")?.trim(),C=u.get("artist")?.trim(),E=u.get("publishedDate")?.trim(),D=(u.get("language")??"").trim(),L=(u.get("lyricHebrew")??"").trim(),T=(u.get("lyricEnglish")??"").trim(),$=(u.get("linkLyrics")??"").trim(),I=(u.get("linkInfo")??"").trim(),A=(u.get("linkYoutube")??"").trim();if(!j||!_||!C||!E){c("error"),x(t.errors.required);return}const M=f.get(C.toLowerCase());if(!M){c("error"),x(t.errors.required);return}const H=L||T?{hebrew:L||void 0,english_translation:T||void 0}:void 0,z=$||I||A?{lyrics:$||void 0,song_info:I||void 0,youtube:A||void 0}:void 0;try{await i({userDisplayName:j,userEmail:S||void 0,song:{name:_,artistId:M,published_date:E,language:D||void 0,lyric_sample:H,links:z}}),c("success"),s?.(),b.reset()}catch(q){console.error("Failed to submit song",q),c("error"),x(t.errors.generic)}};return e.jsxs("div",{className:"border border-neutral-700 rounded-lg p-6 bg-neutral-900/50",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:t.title}),e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:t.fields.displayName}),e.jsx("input",{name:"displayName",type:"text",required:!0,className:"rounded border border-neutral-700 bg-neutral-950 px-3 py-2"})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:t.fields.email}),e.jsx("input",{name:"email",type:"email",className:"rounded border border-neutral-700 bg-neutral-950 px-3 py-2"})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:t.fields.songName}),e.jsx("input",{name:"songName",type:"text",required:!0,className:"rounded border border-neutral-700 bg-neutral-950 px-3 py-2"})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:t.fields.artist}),e.jsx("input",{name:"artist",type:"text",required:!0,list:d,className:"rounded border border-neutral-700 bg-neutral-950 px-3 py-2"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:t.fields.publishedDate}),e.jsx("input",{name:"publishedDate",type:"date",required:!0,className:"rounded border border-neutral-700 bg-neutral-950 px-3 py-2"})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:t.fields.language}),e.jsx("input",{name:"language",type:"text",list:g,className:"rounded border border-neutral-700 bg-neutral-950 px-3 py-2"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:t.fields.lyricHebrew}),e.jsx("textarea",{name:"lyricHebrew",rows:3,className:"rounded border border-neutral-700 bg-neutral-950 px-3 py-2"})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:t.fields.lyricEnglish}),e.jsx("textarea",{name:"lyricEnglish",rows:3,className:"rounded border border-neutral-700 bg-neutral-950 px-3 py-2"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:t.fields.linkLyrics}),e.jsx("input",{name:"linkLyrics",type:"url",className:"rounded border border-neutral-700 bg-neutral-950 px-3 py-2"})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:t.fields.linkInfo}),e.jsx("input",{name:"linkInfo",type:"url",className:"rounded border border-neutral-700 bg-neutral-950 px-3 py-2"})]}),e.jsxs("label",{className:"flex flex-col gap-2",children:[e.jsx("span",{className:"text-sm font-medium",children:t.fields.linkYoutube}),e.jsx("input",{name:"linkYoutube",type:"url",className:"rounded border border-neutral-700 bg-neutral-950 px-3 py-2"})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{type:"submit",disabled:o==="submitting",className:"rounded bg-emerald-500 px-4 py-2 font-semibold text-black disabled:opacity-50",children:o==="submitting"?t.buttons.submitting:t.buttons.submit}),o==="success"&&e.jsx("span",{className:"text-sm text-emerald-400",children:t.success}),o==="error"&&a&&e.jsx("span",{className:"text-sm text-red-400",children:a})]}),e.jsx("datalist",{id:d,children:y.map(m=>e.jsx("option",{value:m.name},m.id))}),e.jsx("datalist",{id:g,children:l.map(m=>e.jsx("option",{value:m},m))})]})]})}function W({label:s,translations:t}){const[i,r]=h.useState(!1);return h.useEffect(()=>{if(!i)return;const n=o=>{o.key==="Escape"&&r(!1)};return window.addEventListener("keydown",n),()=>{window.removeEventListener("keydown",n)}},[i]),e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:()=>r(!0),className:"fixed bottom-6 right-6 z-40 rounded-full bg-emerald-500 px-5 py-3 font-semibold text-black shadow-lg transition hover:bg-emerald-400 focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-300",children:s}),i&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 px-4",children:[e.jsx("button",{type:"button",onClick:()=>r(!1),onKeyDown:n=>{(n.key==="Enter"||n.key===" ")&&r(!1)},className:"absolute inset-0 cursor-default","aria-label":t.modalCloseAria}),e.jsxs("div",{className:"relative z-10 w-full max-w-2xl overflow-y-auto rounded-xl border border-neutral-700 bg-neutral-950 p-6 shadow-2xl",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold",children:t.title}),e.jsx("button",{type:"button",onClick:()=>r(!1),className:"rounded-full p-2 text-neutral-400 transition hover:bg-neutral-800 hover:text-neutral-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-300","aria-label":t.modalCloseAria,children:"✕"})]}),e.jsx(B,{translations:t,onSuccess:()=>{r(!1)}})]})]})]})}function V({translations:s,lang:t}){const[i,r]=h.useState(!1),n=h.useId(),o=h.useId(),c=t==="he";return h.useEffect(()=>{if(!i)return;const a=x=>{x.key==="Escape"&&r(!1)};return window.addEventListener("keydown",a),()=>{window.removeEventListener("keydown",a)}},[i]),e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"fixed top-6 right-6 z-50 flex h-12 w-12 items-center justify-center rounded-full bg-neutral-800 text-lg font-semibold text-white shadow-lg transition hover:bg-neutral-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-300",onClick:()=>r(!0),"aria-label":s.buttonAria,"aria-haspopup":"dialog",children:e.jsx("span",{"aria-hidden":"true",children:"?"})}),i&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 px-4",children:[e.jsx("button",{type:"button",onClick:()=>r(!1),onKeyDown:a=>{(a.key==="Enter"||a.key===" ")&&r(!1)},className:"absolute inset-0 cursor-default","aria-label":s.close}),e.jsxs("div",{role:"dialog","aria-modal":"true","aria-labelledby":n,"aria-describedby":o,dir:c?"rtl":"ltr",className:"relative z-10 w-full max-w-xl rounded-xl border border-neutral-700 bg-neutral-950 p-6 shadow-2xl",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsx("h2",{id:n,className:"text-lg font-semibold text-neutral-100",children:s.modalTitle}),e.jsx("button",{type:"button",onClick:()=>r(!1),className:"rounded-full p-2 text-neutral-400 transition hover:bg-neutral-800 hover:text-neutral-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-300","aria-label":s.close,children:"✕"})]}),e.jsxs("div",{id:o,className:"space-y-4 text-sm text-neutral-200",children:[e.jsx("p",{children:s.description.intro}),e.jsxs("ul",{className:`${c?"list-disc pr-6":"list-disc pl-6"} space-y-2`,children:[e.jsx("li",{children:s.description.columns.left}),e.jsx("li",{children:s.description.columns.right}),e.jsx("li",{children:s.description.borders})]}),e.jsx("p",{children:s.description.submissions})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{type:"button",onClick:()=>r(!1),className:"rounded-full bg-emerald-500 px-4 py-2 text-sm font-semibold text-black transition hover:bg-emerald-400 focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-300",children:s.close})})]})]})]})}function G({title:s,lang:t}){return e.jsx("h1",{className:"text-center text-3xl font-bold tracking-tight text-slate-900 dark:text-slate-100",children:s})}const v={en:{title:"Timeline",subtitle:"Direction is the political leaning of the artist",lyrics:"Lyrics",info:"Info",conflict:"Conflict",reason:"Reason",wikipedia:"Wikipedia",youtube:"YouTube",description:"Description",effects:"Effects",submitSongButton:"Submit a song",submitSongForm:{modalCloseAria:"Close submit song form",title:"Submit a Song",fields:{displayName:"Your name *",email:"Email",songName:"Song name *",artist:"Artist *",publishedDate:"Published date (YYYY-MM-DD) *",language:"Language",lyricHebrew:"Lyric sample (Hebrew)",lyricEnglish:"Lyric sample (English translation)",linkLyrics:"Lyrics link",linkInfo:"Song info link",linkYoutube:"YouTube link"},buttons:{submitting:"Submitting...",submit:"Submit song"},success:"Thanks! We'll review your submission soon.",errors:{required:"Please fill in all required fields.",generic:"Something went wrong while submitting the song. Please try again."}},helpModal:{buttonLabel:"How it works",buttonAria:"Open site explanation",modalTitle:"How to read this timeline",description:{intro:"This site visualizes key moments in the Israeli hip-hop scene alongside major conflicts.",columns:{left:"Left column: Israeli major conflicts",right:"Right column: Songs released in the same period"},borders:"Card borders indicate political leaning — red for left, blue for right, gray for unknown.",submissions:"Want to contribute? Use the Submit a Song button to share missing tracks or context."},close:"Close"},stack:{viewAll:"View songs",close:"Close",songsLabel:"songs"}},he:{title:"ציר זמן",subtitle:"בכיוון הנטייה הפוליטית",lyrics:"מילים",info:"מידע",conflict:"סכסוך",reason:"סיבה",wikipedia:"ויקיפדיה",youtube:"יוטיוב",description:"תיאור",effects:"השפעות",submitSongButton:"הוסף שיר",submitSongForm:{modalCloseAria:"סגור את טופס שליחת השיר",title:"הוסף שיר",fields:{displayName:"השם שלך *",email:"אימייל",songName:"שם השיר *",artist:"אמן *",publishedDate:"תאריך יציאה (YYYY-MM-DD) *",language:"שפה",lyricHebrew:"קטע מילים (עברית)",lyricEnglish:"קטע מילים (תרגום לאנגלית)",linkLyrics:"קישור למילים",linkInfo:"קישור למידע על השיר",linkYoutube:"קישור ליוטיוב"},buttons:{submitting:"שולח...",submit:"שלח שיר"},success:"תודה! נעבור על ההגשה שלך בקרוב.",errors:{required:"אנא מלא את כל השדות החיוניים.",generic:"משהו השתבש בשליחת השיר. נסה שוב בבקשה."}},helpModal:{buttonLabel:"איך זה עובד",buttonAria:"פתח הסבר על האתר",modalTitle:"איך לקרוא את הציר",description:{intro:"האתר מציג אירועים מרכזיים בסצנת ההיפ-הופ הישראלי לצד סכסוכים משמעותיים.",columns:{left:"צד שמאל: סכסוכים מרכזיים בישראל",right:"צד ימין: שירים שיצאו באותה תקופה"},borders:"מסגרת הכרטיס מציינת נטייה פוליטית — אדום לשמאל, כחול לימין, אפור ללא ידוע.",submissions:"רוצים להוסיף? לחצו על כפתור הוסף שיר ושלחו שיר או מידע שחסר."},close:"סגור"},stack:{viewAll:"הצג שירים",close:"סגור",songsLabel:"שירים"}}};function O({label:s,content:t}){return e.jsxs("div",{className:"mt-1 text-sm text-[var(--color-card-foreground)] leading-tight",children:[e.jsxs("strong",{className:"text-[var(--color-card-foreground)]",children:[s,":"]})," ",t]})}function P({title:s}){return e.jsx("h3",{className:"font-semibold text-[var(--color-card-foreground)] text-sm leading-tight",children:s})}function U(){return e.jsx("div",{className:"absolute -right-1 top-1 w-1 h-1 bg-[var(--color-accent)] border border-[var(--color-background)] rounded-full shadow"})}function Q({wikipediaUrl:s,wikipediaLabel:t}){return s?e.jsx("div",{className:"flex gap-1 mt-1 text-xs",children:e.jsx("a",{href:s,target:"_blank",rel:"noreferrer",className:"text-[var(--color-accent)] hover:text-[var(--color-accent-hover)] underline",children:t})}):null}function J({reason:s}){return e.jsx("p",{className:"mt-1 text-sm text-[var(--color-muted-foreground)] leading-tight",children:s})}function X({timestamp:s}){return e.jsx("p",{className:"text-xs text-[var(--color-muted-foreground)]",children:s})}function Z({conflict:s,lang:t}){const i=v[t],r=t==="he"&&s.title_he?s.title_he:s.title,n=t==="he"&&s.reason_he?s.reason_he:s.reason,o=t==="he"&&s.description_he?s.description_he:s.description,c=t==="he"&&s.effects_he?s.effects_he:s.effects;return e.jsxs("div",{className:`z-0 ml-2 mr-10 bg-slate-100 dark:bg-neutral-800 border-slate-300 dark:border-slate-600 border rounded-md p-4 shadow-sm transition-all duration-200 hover:z-50 
                 hover:ring-2 hover:ring-[var(--color-accent)] hover:shadow-lg focus:outline-none focus:z-50 focus:ring-2 focus:ring-[var(--color-accent)] focus:shadow-lg ${t==="he"?"text-right":""}`,children:[e.jsx("div",{className:"flex gap-1 items-start h-full",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(P,{title:r}),e.jsx(J,{reason:n}),o&&e.jsx(O,{label:i.description,content:o}),c&&e.jsx(O,{label:i.effects,content:c}),e.jsx(Q,{wikipediaUrl:s.wikipedia_url,wikipediaLabel:i.wikipedia})]})}),e.jsx(U,{}),e.jsx(X,{timestamp:s.timestamp})]})}function ee({conflicts:s,index:t,lang:i}){const r=s.filter(n=>n.type==="conflict");return r.length===0?null:e.jsx("div",{className:`col-1 ml-4 row-${t+1} ${i==="he"?"ml-0 mr-4":""}`,children:r.map(n=>{const o=n.conflictEntry;return o?e.jsx("div",{"data-conflict-id":o.id,className:"mb-4",children:e.jsx(Z,{conflict:o,lang:i})},o.id):null})})}function R({song:s,lang:t,timestamp:i,leaning:r,className:n,showMarginTop:o=!0,variant:c="full"}){const a=v[t],x={left:"border-blue-600",right:"border-red-600",center:"border-yellow-600",unknown:"border-gray-600"},d=s,g=typeof s=="object"&&s!==null,y=g&&"name"in d&&"artist"in d&&!!d.name&&!!d.artist,l=c==="compact",f=g&&!l&&"lyric_sample"in d?d.lyric_sample:void 0,p=g&&!l&&"links"in d?d.links:void 0,m=t==="he"?"ml-4 mr-auto text-right":"mr-4 ml-auto",b=["relative w-full max-w-md bg-[var(--color-card-background)] border border-[var(--color-border)] rounded-md shadow-sm transition-transform duration-200",x[r],m,o?"mt-4":"",l?"p-3 space-y-1.5":"p-4 space-y-3",n??""].filter(Boolean).join(" "),u=l?"text-lg font-semibold leading-tight text-[var(--color-card-foreground)]":"text-xl font-semibold leading-snug text-[var(--color-card-foreground)]",j=l?"text-[0.7rem] uppercase tracking-wide text-[var(--color-muted-foreground)]":"text-sm text-[var(--color-muted-foreground)]",N=t==="he"?f?.hebrew??f?.english_translation:f?.english_translation??f?.hebrew;return e.jsxs("div",{className:b,children:[y&&e.jsx("div",{className:t==="he"?l?"flex flex-col gap-0.5 text-right":"flex flex-col gap-1 text-right":l?"flex flex-col gap-0.5":"flex items-baseline gap-2",children:t==="he"?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:j,children:d.artist}),e.jsx("h3",{className:u,children:d.name})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:u,children:d.name}),e.jsx("span",{className:j,children:d.artist})]})}),!l&&f&&N&&e.jsxs("p",{className:`text-sm text-[var(--color-muted-foreground)] opacity-90 ${t==="he"?"text-right":""}`,dir:t==="he"&&f?.hebrew?"rtl":"ltr",children:['"',N,'"']}),!l&&p&&e.jsxs("div",{className:`flex gap-3 text-sm ${t==="he"?"flex-row-reverse":""}`,children:[p?.lyrics&&e.jsx("a",{href:p.lyrics,target:"_blank",rel:"noreferrer",className:"no-underline hover:underline text-[color:var(--color-accent)]/90 hover:text-[var(--color-accent-hover)] font-medium",children:a.lyrics}),p?.song_info&&e.jsx("a",{href:p.song_info,target:"_blank",rel:"noreferrer",className:"no-underline hover:underline text-[color:var(--color-accent)]/90 hover:text-[var(--color-accent-hover)] font-medium",children:a.info}),p?.youtube&&e.jsx("a",{href:p.youtube,target:"_blank",rel:"noreferrer",className:"no-underline hover:underline text-[color:var(--color-accent)]/90 hover:text-[var(--color-accent-hover)] font-medium",children:a.youtube})]}),e.jsx("p",{className:[l?"text-[0.65rem]":"text-xs","text-[var(--color-muted-foreground)] opacity-70",t==="he"?"text-left":""].filter(Boolean).join(" "),children:i})]})}function te({lang:s,year:t,viewAllLabel:i,songCountText:r,closeLabel:n,onClose:o}){return e.jsxs("div",{className:`flex items-start justify-between ${s==="he"?"flex-row-reverse":""}`,children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm uppercase tracking-wide text-slate-200/80",children:t}),e.jsxs("h2",{className:`mt-1 text-2xl font-semibold text-white ${s==="he"?"text-right":""}`,dir:s==="he"?"rtl":void 0,children:[i," ",r]})]}),e.jsx("button",{type:"button",onClick:o,className:"rounded-full border border-white/30 bg-white/10 px-4 py-1 text-sm font-medium text-white transition hover:bg-white/20 focus:outline-none focus-visible:ring-2 focus-visible:ring-white/70",children:n})]})}function se({songs:s,lang:t,year:i,isExpanded:r,onClose:n,songCountText:o}){const c=v[t];return e.jsx("dialog",{open:r,className:`fixed inset-0 z-50 flex h-screen w-full items-center justify-center bg-transparent p-0 backdrop-grayscale-100 backdrop-blur-sm transition-all duration-300 ${r?"opacity-100":"opacity-0"}`,"aria-modal":"true",onCancel:a=>{a.preventDefault(),n()},onClick:a=>{a.target===a.currentTarget&&n()},onKeyDown:a=>{a.key==="Escape"&&n()},children:e.jsxs("div",{className:`mx-auto flex w-full max-w-5xl flex-col px-4 py-10 transition-all duration-500 ease-out ${r?"translate-y-0 scale-100 opacity-100":"translate-y-6 scale-95 opacity-0"}`,role:"document",style:{maxHeight:"calc(100vh - 4rem)"},children:[e.jsx(te,{lang:t,year:i,viewAllLabel:c.stack.viewAll,songCountText:o,closeLabel:c.stack.close,onClose:n}),e.jsx("div",{className:"mt-8 flex-1 overflow-y-auto",children:e.jsx("div",{className:"grid gap-6 md:grid-cols-2",children:s.map((a,x)=>e.jsx(R,{song:a.song,lang:t,timestamp:a.timestamp,leaning:a.leaning,showMarginTop:!1,className:"ml-0 mr-0 w-full max-w-full bg-[var(--color-card-background)] text-left shadow-xl border border-[var(--color-border)]",variant:"full"},`${a.song.artist}-${a.song.name}-expanded-${x}`))})})]})})}function re(s,t,i){return s==="he"?t===1?"שיר אחד":t===2?"שני שירים":`${t} שירים`:`${t} ${t===1?"song":i}`}const ne=-40,w=[-1.8,1.2,-.9,1.6],F=[.94,.96,.92,.95];function ie({songs:s,lang:t,isExpanded:i,isOverlayVisible:r}){return e.jsx("div",{className:`transition-all duration-300 ease-out ${r?"pointer-events-none":""} ${i?"opacity-0 scale-95":"opacity-100 scale-100"}`,children:s.map((n,o)=>{const c=`${n.song.artist}-${n.song.name}`,a=Array.from(c).reduce((m,b)=>m+b.charCodeAt(0),0),x=w[a%w.length],d=(o-s.length/2)*ne,g=w[(a+1)%w.length],y=i?"0deg":`${x}deg`,l=i?"0deg":`${g}deg`,f=i?"0":`${d}px`,p=i?"1":`${F[o%F.length]}`;return e.jsx("div",{className:"transition-transform duration-300 rotate-(--rotate) translate-y-(--translate-y) scale-(--scale) hover:rotate-(--hover-rotate)",style:{"--rotate":y,"--translate-y":f,"--scale":p,"--hover-rotate":l},children:e.jsx(R,{song:n.song,lang:t,timestamp:n.timestamp,leaning:n.leaning,showMarginTop:o===0,className:`${i?"":"pointer-events-none px-3 py-3 text-sm"} ${t==="he"?"ml-4 mr-auto":"mr-4 ml-auto"}`,variant:"compact"})},`${n.song.artist}-${n.song.name}-${o}`)})})}const oe=350;function le({songs:s,lang:t,year:i}){const r=v[t],[n,o]=h.useState(!1),[c,a]=h.useState(!1),[x,d]=h.useState(!1);h.useEffect(()=>{d(!0)},[]),h.useEffect(()=>{if(!c)return;const m=u=>{u.key==="Escape"&&o(!1)},b=document.body.style.overflow;return document.body.style.overflow="hidden",window.addEventListener("keydown",m),()=>{window.removeEventListener("keydown",m),document.body.style.overflow=b}},[c]),h.useEffect(()=>{if(!c||n)return;const m=window.setTimeout(()=>{a(!1)},oe);return()=>{window.clearTimeout(m)}},[c,n]);const g=h.useMemo(()=>s,[s]),y=s.length,l=re(t,y,r.stack.songsLabel),f=()=>{if(c){o(!0);return}a(!0),requestAnimationFrame(()=>{o(!0)})},p=()=>{o(!1)};return g.length===0?null:e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:f,className:`w-full text-left focus:outline-none ${t==="he"?"text-right":""}`,"aria-expanded":n,"aria-label":`${r.stack.viewAll} ${l}`,children:e.jsx(ie,{songs:g,lang:t,isExpanded:n,isOverlayVisible:c})}),x&&c&&e.jsx(se,{songs:s,lang:t,year:i,isExpanded:n,onClose:p,songCountText:l})]})}function ae({songs:s,lang:t,year:i,index:r}){const n=s.filter(o=>o.type==="song");return n.length===0?null:e.jsx("div",{className:`col-3 mr-4 mb-4 row-${r+1} ${t==="he"?"mr-0 ml-4":""}`,"aria-hidden":n.length===0,children:e.jsx(le,{songs:n.map(o=>({song:o.song,timestamp:o.timestamp,leaning:o.leaning})),lang:t,year:i})})}function ce({year:s,showYear:t,index:i}){return e.jsxs("div",{style:{gridColumn:2,gridRow:i+1},className:"h-full flex flex-col items-center gap-3 relative",children:[e.jsx("div",{className:"absolute inset-y-0 w-px bg-slate-200 dark:bg-slate-700 left-1/2 -translate-x-1/2"}),t&&e.jsx("div",{className:"text-center text-slate-700 dark:text-slate-300 text-sm font-semibold tabular-nums",children:s}),e.jsx("div",{className:"h-3 w-3 rounded-full bg-slate-400 border-2 border-white dark:border-zinc-900","aria-hidden":!0})]})}function de({year:s,entries:t,showYear:i,index:r,lang:n}){const o=t.filter(a=>a.type==="song"),c=t.filter(a=>a.type==="conflict");return e.jsxs(e.Fragment,{children:[e.jsx(ee,{index:r,conflicts:c,lang:n}),e.jsx(ce,{index:r,year:s,showYear:i}),e.jsx(ae,{index:r,songs:o,lang:n,year:s})]})}function ue(s){return{time:{start:s.start,end:s.end},conflict:{title:s.title,title_he:s.title_he,reason:s.reason,reason_he:s.reason_he,description:s.description,description_he:s.description_he,effects:s.effects,effects_he:s.effects_he,wikipedia_url:s.wikipedia_url}}}function me(s){return s.map(ue)}function fe(s,t){const i=new Date(s),n=(t?new Date(t):new Date).getTime()-i.getTime();return Math.ceil(n/(1e3*3600*24))}function xe(s){return s.map((t,i)=>{const r=new Date(t.time.start),n=t.time.end?new Date(t.time.end):null,o=fe(t.time.start,t.time.end),c=r.getFullYear();if(!t.conflict)throw new Error(`Conflict ${i} is missing conflict data`);return{id:`conflict-${i}`,startDate:r,endDate:n,duration:o,title:t.conflict.title,title_he:t.conflict.title_he,reason:t.conflict.reason,reason_he:t.conflict.reason_he,description:t.conflict.description,description_he:t.conflict.description_he,effects:t.conflict.effects,effects_he:t.conflict.effects_he,wikipedia_url:t.conflict.wikipedia_url,positionIndex:0,totalConflicts:1,year:c,timestamp:t.time.end?`${r.toLocaleDateString()} - ${n?.toLocaleDateString()}`:r.toLocaleDateString(),song:{name:"",artist:"",published_date:t.time.start,language:""},leaning:"center",conflict:{title:t.conflict.title,title_he:t.conflict.title_he,reason:t.conflict.reason,reason_he:t.conflict.reason_he,description:t.conflict.description,description_he:t.conflict.description_he,effects:t.conflict.effects,effects_he:t.conflict.effects_he,wikipedia_url:t.conflict.wikipedia_url}}})}function he(s){const t=[...s].sort((r,n)=>r.startDate.getTime()-n.startDate.getTime()),i=new Map;return t.forEach(r=>{i.has(r.year)||i.set(r.year,[]),i.get(r.year)?.push(r)}),i.forEach(r=>{r.forEach((n,o)=>{n.positionIndex=o,n.totalConflicts=r.length})}),t}function ge(s){const t=s?.affiliation?.toLowerCase();return t?t.includes("left")?"left":t.includes("right")?"right":t.includes("center")?"center":"unknown":"unknown"}function pe(s){return new Date(s).getFullYear()}function be(s,t){const i=s.flatMap(l=>({year:pe(l.published_date),timestamp:new Date(l.published_date).toLocaleDateString(),song:l,leaning:ge(l.artist_details)})).filter(l=>Number.isFinite(l.year)).sort((l,f)=>l.year-f.year),r=xe(t),n=he(r),o=i.map(l=>({type:"song",year:l.year,timestamp:l.timestamp,song:l.song,leaning:l.leaning,position:0}));n.forEach(l=>{o.push({type:"conflict",year:l.year,timestamp:l.timestamp,song:l.song,leaning:l.leaning,conflict:l.conflict,conflictEntry:l,maxStackLevel:0,position:0})});const c=new Map;o.forEach(l=>{c.has(l.year)||c.set(l.year,[]);const f=c.get(l.year);f&&f.push(l)});const a=Array.from(c.entries()).sort(([l],[f])=>l-f);if(a.length===0)return a;const x=a.map(([l])=>l),d=Math.min(...x),g=Math.max(...x),y=Math.max(g-d,1);return a.forEach(([l,f])=>{const p=(l-d)/y;f.forEach(m=>{m.position=p})}),a}function ve({lang:s="he",initialData:t}){const i=v[s],r=t?.songs??[],n=t?.events??[],o=me(n??[]),c=be(r??[],o);return e.jsxs("div",{className:"relative overflow-x-hidden",children:[e.jsx(G,{title:i.title,lang:s}),e.jsx(V,{translations:i.helpModal,lang:s}),e.jsx("div",{className:`w-full mt-10 grid grid-rows-[${c.length}] grid-cols-[1fr_50px_1fr] pb-24`,children:c.map(([a,x],d)=>{const g=d===0||a!==c[d-1]?.[0];return e.jsx(de,{index:d,year:a,entries:x,showYear:g,lang:s},a)})}),e.jsx(W,{label:i.submitSongButton,translations:i.submitSongForm})]})}export{ve as T};
